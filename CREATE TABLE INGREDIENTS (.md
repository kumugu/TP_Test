CREATE TABLE INGREDIENTS (
    ID NUMBER PRIMARY KEY,           -- 재료 고유 ID
    NAME VARCHAR2(100) NOT NULL,     -- 재료명
    CATEGORY VARCHAR2(50),           -- 재료 카테고리 (예: 빵, 고기)
    STOCK NUMBER NOT NULL,           -- 현재 재고량
    UNIT_PRICE NUMBER NOT NULL,      -- 재료 단가
    REGISTER_DATE DATE DEFAULT SYSDATE, -- 등록일
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' -- 재료 상태 (ACTIVE/INACTIVE)
);

CREATE SEQUENCE INGREDIENT_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;


CREATE TABLE PRODUCTS (
    ID NUMBER PRIMARY KEY,           -- 상품 고유 ID
    NAME VARCHAR2(100) NOT NULL,     -- 상품명
    CATEGORY VARCHAR2(50),           -- 상품 카테고리 (예: 햄버거, 음료)
    PRICE NUMBER NOT NULL,           -- 상품 가격
    STATUS VARCHAR2(20) DEFAULT 'ACTIVE' -- 상품 상태 (ACTIVE/INACTIVE)
);

CREATE SEQUENCE PRODUCT_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;


CREATE TABLE PRODUCT_INGREDIENTS (
    PRODUCT_ID NUMBER REFERENCES PRODUCTS(ID) ON DELETE CASCADE,  -- 상품 ID (FK)
    INGREDIENT_ID NUMBER REFERENCES INGREDIENTS(ID) ON DELETE CASCADE, -- 재료 ID (FK)
    QUANTITY NUMBER NOT NULL,          -- 해당 상품에 필요한 재료 수량
    PRIMARY KEY (PRODUCT_ID, INGREDIENT_ID)
);


CREATE TABLE SALES (
    ID NUMBER PRIMARY KEY,            -- 판매 기록 고유 ID
    PRODUCT_ID NUMBER REFERENCES PRODUCTS(ID), -- 판매된 상품 ID (FK)
    QUANTITY NUMBER NOT NULL,         -- 판매된 수량
    SALE_DATE DATE DEFAULT SYSDATE,   -- 판매 날짜
    TOTAL_AMOUNT NUMBER NOT NULL,     -- 총 판매 금액
    STATUS VARCHAR2(20) DEFAULT 'COMPLETED' -- 판매 상태
);

CREATE SEQUENCE SALES_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;


DELETE FROM PRODUCT_INGREDIENTS;

DELETE FROM SALES;
DELETE FROM PRODUCTS;

DELETE FROM INGREDIENTS;
DROP TABLE PRODUCT_INGREDIENTS CASCADE CONSTRAINTS;
DROP TABLE SALES CASCADE CONSTRAINTS;
DROP TABLE PRODUCTS CASCADE CONSTRAINTS;
DROP TABLE INGREDIENTS CASCADE CONSTRAINTS;

DROP SEQUENCE PRODUCT_SEQ;
DROP SEQUENCE INGREDIENT_SEQ;
DROP SEQUENCE SALES_SEQ;



CREATE SEQUENCE PRODUCT_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;


CREATE OR REPLACE TRIGGER PRODUCT_ID_TRIGGER
BEFORE INSERT ON PRODUCTS
FOR EACH ROW
BEGIN
    IF :NEW.ID IS NULL THEN
        SELECT PRODUCT_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
    END IF;
END;
/

SELECT PRODUCT_SEQ.NEXTVAL FROM DUAL;



CREATE SEQUENCE INGREDIENT_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;



SELECT CONSTRAINT_NAME, COLUMN_NAME
FROM USER_CONS_COLUMNS
WHERE CONSTRAINT_NAME = 'SYS_C007230';


SELECT INGREDIENT_SEQ.CURRVAL, INGREDIENT_SEQ.NEXTVAL FROM DUAL;



CREATE TABLE CATEGORIES (
    ID NUMBER PRIMARY KEY,        -- 카테고리 고유 ID
    NAME VARCHAR2(50) UNIQUE NOT NULL -- 카테고리 이름 (중복 방지)
);

-- 시퀀스 생성
CREATE SEQUENCE CATEGORY_SEQ
START WITH 1
INCREMENT BY 1
NOCACHE;



ALTER TABLE CATEGORIES ADD TYPE VARCHAR2(20);

-- 기존 카테고리 유형 지정 (예: 상품)
UPDATE CATEGORIES SET TYPE = '상품' WHERE TYPE IS NULL;



-- 상품 카테고리
INSERT INTO CATEGORIES (ID, NAME, TYPE) VALUES (CATEGORY_SEQ.NEXTVAL, '햄버거', '상품');
INSERT INTO CATEGORIES (ID, NAME, TYPE) VALUES (CATEGORY_SEQ.NEXTVAL, '음료', '상품');
INSERT INTO CATEGORIES (ID, NAME, TYPE) VALUES (CATEGORY_SEQ.NEXTVAL, '사이드', '상품');

-- 재료 카테고리
INSERT INTO CATEGORIES (ID, NAME, TYPE) VALUES (CATEGORY_SEQ.NEXTVAL, '빵', '재료');
INSERT INTO CATEGORIES (ID, NAME, TYPE) VALUES (CATEGORY_SEQ.NEXTVAL, '고기', '재료');